<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Registration - Sample Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-2xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h1 class="text-3xl font-bold text-center text-indigo-600 mb-8">Event Registration</h1>
                
                <form id="registrationForm" class="space-y-6">
                    <!-- Personal Information -->
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Personal Information</h2>
                        
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                                <input type="text" id="name" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                <input type="email" id="email" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Phone *</label>
                                <input type="tel" id="phone" required pattern="[0-9]{10}"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Gender *</label>
                                <select id="gender" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="">Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                    <option value="Physically Challenged">Physically Challenged</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Academic Information -->
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Academic Information</h2>
                        
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">College Name *</label>
                                <input type="text" id="college" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">State *</label>
                                <input type="text" id="state" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Year *</label>
                                <select id="year" required 
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="">Select Year</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Event Selection -->
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Event Selection</h2>
                        <div id="eventsList" class="space-y-2">
                            <!-- Events will be loaded dynamically -->
                            <p class="text-gray-500">Loading events...</p>
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-gray-900 mb-2">Registration Fee</h3>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">Total Amount:</span>
                            <span id="totalAmount" class="text-2xl font-bold text-indigo-600">₹0</span>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">
                            One-time registration fee:<br>
                            Sports - Male: ₹350, Female: ₹250<br>
                            Cultural - Male: ₹250, Female: ₹250
                        </p>
                    </div>

                    <!-- Team Details (Optional) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Team Details (Optional)</label>
                        <textarea id="teamDetails" rows="3" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            placeholder="Enter team details if applicable..."></textarea>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex space-x-4">
                        <button type="submit" 
                            class="flex-1 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-semibold">
                            Proceed to Payment
                        </button>
                        <button type="reset" 
                            class="px-6 bg-gray-200 text-gray-800 py-3 rounded-lg hover:bg-gray-300 transition font-semibold">
                            Reset
                        </button>
                    </div>
                </form>

                <!-- Success Message (Hidden by default) -->
                <div id="successMessage" class="hidden mt-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-lg">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p class="text-green-700 font-medium">Registration successful! Check your email for confirmation.</p>
                    </div>
                </div>

                <!-- Error Message (Hidden by default) -->
                <div id="errorMessage" class="hidden mt-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg">
                    <div class="flex items-center">
                        <svg class="w-6 h-6 text-red-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p id="errorText" class="text-red-700 font-medium"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_URL = 'http://localhost:5000';
        let selectedEvents = [];
        let allEvents = [];

        // Load events on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadEvents();
            setupFormHandlers();
        });

        // Load events from API
        async function loadEvents() {
            try {
                // Note: You may need to make events endpoint public or handle authentication
                const response = await fetch(`${API_URL}/api/events`);
                const events = await response.json();
                allEvents = events;
                displayEvents(events);
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('eventsList').innerHTML = 
                    '<p class="text-red-500">Failed to load events. Please refresh the page.</p>';
            }
        }

        // Display events as checkboxes
        function displayEvents(events) {
            const eventsList = document.getElementById('eventsList');
            
            if (events.length === 0) {
                eventsList.innerHTML = '<p class="text-gray-500">No events available at the moment.</p>';
                return;
            }

            eventsList.innerHTML = events.map(event => `
                <div class="flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50">
                    <input type="checkbox" id="event_${event._id}" value="${event._id}" 
                        data-type="${event.eventType}"
                        class="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-500">
                    <label for="event_${event._id}" class="flex-1 cursor-pointer">
                        <div class="font-medium text-gray-900">${event.eventSubtype}</div>
                        <div class="text-sm text-gray-500">
                            <span class="px-2 py-0.5 bg-${event.eventType === 'sports' ? 'blue' : 'purple'}-100 text-${event.eventType === 'sports' ? 'blue' : 'purple'}-800 rounded text-xs font-medium">
                                ${event.eventType.toUpperCase()}
                            </span>
                            <span class="ml-2">
                                Male: ₹${event.malesFee} | Female: ₹${event.femalesFee}
                            </span>
                        </div>
                    </label>
                </div>
            `).join('');

            // Add event listeners to checkboxes
            document.querySelectorAll('#eventsList input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateTotalAmount);
            });
        }

        // Update total amount based on selected events and gender
        function updateTotalAmount() {
            const gender = document.getElementById('gender').value;
            const checkboxes = document.querySelectorAll('#eventsList input[type="checkbox"]:checked');
            
            selectedEvents = Array.from(checkboxes).map(cb => cb.value);
            
            let total = 0;
            let hasCalculated = false;

            checkboxes.forEach(checkbox => {
                const eventId = checkbox.value;
                const event = allEvents.find(e => e._id === eventId);
                
                if (event && gender && !hasCalculated) {
                    // One-time registration fee (not per event)
                    total = gender === 'Male' ? 
                        (event.eventType === 'sports' ? 350 : 250) : 
                        250;
                    hasCalculated = true;
                }
            });

            document.getElementById('totalAmount').textContent = `₹${total}`;
        }

        // Setup form handlers
        function setupFormHandlers() {
            const form = document.getElementById('registrationForm');
            const genderSelect = document.getElementById('gender');

            // Update amount when gender changes
            genderSelect.addEventListener('change', updateTotalAmount);

            // Handle form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleRegistration();
            });
        }

        // Handle registration submission
        async function handleRegistration() {
            // Hide previous messages
            document.getElementById('successMessage').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');

            // Validate event selection
            if (selectedEvents.length === 0) {
                showError('Please select at least one event');
                return;
            }

            // Get form data
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                gender: document.getElementById('gender').value,
                college: document.getElementById('college').value,
                state: document.getElementById('state').value,
                year: document.getElementById('year').value,
                events: selectedEvents,
                amountPaid: parseInt(document.getElementById('totalAmount').textContent.replace('₹', '')),
                paymentStatus: 'Pending', // Will be updated after payment
                teamDetails: document.getElementById('teamDetails').value
            };

            try {
                // In real implementation, integrate payment gateway here
                // After successful payment, update paymentStatus to 'Paid'
                
                const response = await fetch(`${API_URL}/api/registrations/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error('Registration failed');
                }

                const result = await response.json();
                console.log('Registration successful:', result);
                
                // Show success message
                document.getElementById('successMessage').classList.remove('hidden');
                
                // Reset form
                document.getElementById('registrationForm').reset();
                selectedEvents = [];
                updateTotalAmount();
                
                // Scroll to success message
                document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Registration error:', error);
                showError(error.message || 'Registration failed. Please try again.');
            }
        }

        // Show error message
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
            document.getElementById('errorMessage').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
